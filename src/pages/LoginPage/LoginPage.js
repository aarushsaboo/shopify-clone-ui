import React from 'react';
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import './LoginPage.css'

const LoginPage = () => {
  const [email, setEmail] = useState("")
  const [password, setPassword] = useState("")
  const [showPasswordField, setShowPasswordField] = useState(false)
  const navigate = useNavigate()

  const handleChange = (e, field) => {
    if (field === "email") {
      setEmail(e.target.value)
    }
    else if (field === "password") {
      setPassword(e.target.value)
    }
  }
  const handleCheckEmail = async () => {
    try {
      const response = await fetch('http://localhost:8000/login-email', {
        method: 'POST',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({email})
      })
      const data = await response.json()

      if (data.emailExists) {
        setShowPasswordField(true)
      } else {
        console.log("Email doesn't exist")
      }
    }
    catch (err) {
      console.error(err)
    }
  }

  const handleLogin = async () => {
    try {
      const response = await fetch('http://localhost:8000/login', {
        method: 'POST',
        headers: {
          "Content-type": "application/json"
        }, 
        body: JSON.stringify({email, password})
      })
      const data = await response.json()
      if (response.ok) {
        localStorage.setItem('token' , data.token)
        navigate('/')
      } else {
        console.log('Login failed', data.message)
      }
    } catch (err) {
      console.error(err)
    }
  }
    return (
      <div className="login-page">
        <div className={`white-box ${showPasswordField ? "smaller-white-box": ""}`}>
          <div className="login-card">
            <svg
              viewBox="0 0 609 177"
              xmlns="http://www.w3.org/2000/svg"
              onClick={() => navigate("/")}
            >
              <g fill="none" fill-rule="evenodd">
                <path
                  d="M130.8 32.7c-.1-.9-.8-1.3-1.4-1.3l-12.7-.3-11.1-10.8c-1-1-3-.8-3.7-.5l-5 1.6c-.6-1.7-1.4-3.8-2.5-6-3.5-6.8-8.9-10.5-15.2-10.5a5 5 0 00-1.4.2l-.6-.7C74.4 1.5 71 .1 66.6.2c-8.1.2-16.3 6.2-23 16.7a68.7 68.7 0 00-9.3 23.8c-9.3 3-16 5-16.2 5-4.7 1.5-4.8 1.6-5.4 6.1C12.4 55.2 0 151.3 0 151.3l104.3 18 45.1-11.1-18.6-125.5zm-39.2-9.6l-8 2.5c0-4.1-.7-10-2.5-14.8 6.2 1 9.3 8 10.5 12.3zM78 27.2l-17.4 5.4a42 42 0 018.7-17c1.5-1.7 3.6-3.4 5.9-4.3 2.4 4.7 2.9 11.4 2.8 16zM66.9 5.7c2 0 3.5.3 4.8 1.3a21.6 21.6 0 00-6.3 5 47.5 47.5 0 00-10.8 22.6L40.3 39c3-13.2 14-33 26.6-33.3z"
                  fill="#95BF47"
                />
                <path
                  d="M129.4 31.4l-12.7-.3-11.1-10.8a2 2 0 00-1.3-.6v149.7l45.1-11.2L131 32.7c-.2-.9-1-1.3-1.5-1.3z"
                  fill="#5E8E3E"
                />
                <path
                  d="M79.2 54.6l-5.3 19.6s-5.8-2.6-12.8-2.2C51 72.6 51 79.1 51 80.7c.6 8.8 23.6 10.7 25 31.3 1 16.2-8.5 27.3-22.4 28.1a34.2 34.2 0 01-25.7-8.9l3.5-15s9.3 7 16.6 6.5a6.5 6.5 0 006.3-7c-.7-11.4-19.5-10.7-20.7-29.5-1-15.9 9.4-31.8 32.3-33.3 8.9-.6 13.4 1.7 13.4 1.7z"
                  fill="#FFF"
                />
                <g fill="#000">
                  <path d="M210.6 96.4c-5.2-2.8-8-5.2-8-8.5 0-4.2 3.9-6.8 9.7-6.8 6.8 0 13 2.8 13 2.8l4.7-14.7s-4.4-3.4-17.3-3.4c-18 0-30.6 10.4-30.6 24.9 0 8.3 5.8 14.5 13.6 19 6.4 3.5 8.6 6 8.6 9.8 0 4-3.2 7.1-9 7.1-8.7 0-17-4.5-17-4.5l-5.1 14.6s7.6 5.1 20.3 5.1c18.6 0 32-9.1 32-25.5-.2-9-6.9-15.3-15-19.9zM284.4 65.6c-9.1 0-16.3 4.4-21.8 11l-.2-.2 7.9-41.4h-20.6l-20.1 105.5h20.6l6.8-36c2.7-13.7 9.7-22.1 16.3-22.1 4.6 0 6.5 3.2 6.5 7.7 0 2.8-.3 6.3-.9 9.1l-7.8 41.3h20.6l8-42.6c.9-4.5 1.5-9.9 1.5-13.6.1-11.7-6-18.7-16.8-18.7zM348 65.6c-24.9 0-41.3 22.4-41.3 47.4 0 16 9.9 28.8 28.4 28.8 24.3 0 40.8-21.8 40.8-47.3.1-14.8-8.6-29-28-29zM337.9 126c-7 0-10-6-10-13.5 0-11.8 6-31 17.3-31 7.3 0 9.7 6.3 9.7 12.4 0 12.6-6.2 32.1-17 32.1zM428.7 65.6C415 65.6 407 77.9 407 77.9h-.2l1.2-11.1h-18.3c-.8 7.4-2.5 18.9-4.1 27.4l-14.4 75.5h20.6l5.7-30.5h.5s4.3 2.6 12 2.6c24.3 0 40.2-24.8 40.2-50 0-13.8-6.3-26.2-21.4-26.2zM409 126.4c-5.4 0-8.5-3-8.5-3l3.4-19.3c2.4-13 9.1-21.5 16.3-21.5 6.3 0 8.3 5.9 8.3 11.4 0 13.4-8 32.4-19.5 32.4zM479.5 36c-6.6 0-11.8 5.2-11.8 12 0 6 4 10.3 9.8 10.3h.2c6.5 0 12-4.4 12-12 0-6-4-10.3-10.2-10.3zM450.7 140.4h20.5l14-73.1h-20.7zM537.7 67.2h-14.3l.7-3.4c1.2-7.1 5.4-13.3 12.3-13.3 3.7 0 6.6 1 6.6 1l4-16.1s-3.5-1.8-11.2-1.8a31 31 0 00-20.2 6.8c-7 6-10.4 14.6-12 23.4l-.6 3.4h-9.6l-3 15.6h9.6l-11 57.7h20.6l11-57.7h14.2l3-15.6zM587.4 67.3s-12.9 32.5-18.6 50.3h-.2c-.4-5.7-5.2-50.3-5.2-50.3h-21.6l12.4 67.1c.2 1.5.1 2.4-.5 3.4a36.1 36.1 0 01-11.2 12.4 47.6 47.6 0 01-11.7 5.9l5.7 17.5c4.2-.8 13-4.4 20.2-11.2a138 138 0 0027-41L609 67.4h-21.6z" />
                </g>
              </g>
            </svg>
            <div className="heading-container">
              <h1>Log in</h1>
              <h3>Continue to Shopify account</h3>
            </div>
            <label htmlFor="email">Email</label>
            <input
              type="email"
              name="email"
              id="email"
              onChange={(e) => handleChange(e, "email")}
            ></input>
            {showPasswordField && (
              <>
                <label htmlFor="password">Password</label>
                <input
                  type="password"
                  name="password"
                  id="password"
                  onChange={(e) => handleChange(e, "password")}
                ></input>
                <button onClick={handleLogin}>Log in</button>
                <button className='show-password-button'>Log in using a different method</button>
              </>
            )}
            {
              !showPasswordField && <>
                <button onClick={handleCheckEmail}>
                  Continue with email
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M3.49951 10C3.49951 9.58579 3.8353 9.25 4.24951 9.25L13.9391 9.25L11.2192 6.53036C10.9263 6.23748 10.9263 5.7626 11.2192 5.4697C11.512 5.17679 11.9869 5.17676 12.2798 5.46964L16.2802 9.46964C16.4209 9.6103 16.4999 9.80107 16.4999 10C16.4999 10.1989 16.4209 10.3897 16.2802 10.5304L12.2798 14.5304C11.9869 14.8232 11.512 14.8232 11.2192 14.5303C10.9263 14.2374 10.9263 13.7625 11.2192 13.4696L13.9391 10.75L4.24951 10.75C3.8353 10.75 3.49951 10.4142 3.49951 10Z"
                      fill="currentColor"
                    ></path>
                  </svg>
                </button>
                <button>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M9 3C7.067 3 5.5 4.567 5.5 6.5C5.5 8.433 7.067 10 9 10C10.933 10 12.5 8.433 12.5 6.5C12.5 4.567 10.933 3 9 3ZM7 6.5C7 5.39543 7.89543 4.5 9 4.5C10.1046 4.5 11 5.39543 11 6.5C11 7.60457 10.1046 8.5 9 8.5C7.89543 8.5 7 7.60457 7 6.5Z"
                      fill="currentColor"
                    ></path>
                    <path
                      d="M4.82727 14.9552C5.66915 13.4398 7.26644 12.5 8.99999 12.5C9.4142 12.5 9.74999 12.1642 9.74999 11.75C9.74999 11.3358 9.4142 11 8.99999 11C6.72169 11 4.62247 12.2352 3.51603 14.2268L3.07937 15.0128C2.58406 15.9043 3.22875 17 4.24867 17H10.25C10.6642 17 11 16.6642 11 16.25C11 15.8358 10.6642 15.5 10.25 15.5H4.52463L4.82727 14.9552Z"
                      fill="currentColor"
                    ></path>
                    <path
                      d="M15.125 12.5C15.6082 12.5 16 12.1082 16 11.625C16 11.1418 15.6082 10.75 15.125 10.75C14.6418 10.75 14.25 11.1418 14.25 11.625C14.25 12.1082 14.6418 12.5 15.125 12.5Z"
                      fill="currentColor"
                    ></path>
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M17.6745 14.8747C18.3217 14.4561 18.75 13.7281 18.75 12.9V11.625C18.75 9.62297 17.127 8 15.125 8C13.123 8 11.5 9.62297 11.5 11.625V12.9C11.5 13.8004 12.0064 14.5826 12.75 14.9772V16.8509C12.75 17.24 12.8635 17.6207 13.0766 17.9462L13.4986 18.591C14.1635 19.6068 15.5727 19.8007 16.4873 19.0023L17.0399 18.5198C17.7394 17.9091 17.9009 16.9369 17.5338 16.1584C17.7228 15.7633 17.7765 15.3088 17.6745 14.8747ZM14.2026 13.9609C14.1351 13.8353 14.0025 13.75 13.85 13.75C13.3806 13.75 13 13.3694 13 12.9V11.625C13 10.4514 13.9514 9.5 15.125 9.5C16.2986 9.5 17.25 10.4514 17.25 11.625V12.9C17.25 13.3694 16.8694 13.75 16.4 13.75H16.1818C15.9938 13.75 15.8301 13.8537 15.7447 14.0071C15.7202 14.051 15.7021 14.0991 15.6918 14.15C15.6853 14.1823 15.6818 14.2158 15.6818 14.25V14.3215C15.6818 14.4106 15.7056 14.4975 15.75 14.5736C15.7632 14.5961 15.7781 14.6177 15.7948 14.6381L16.1262 15.0431C16.1487 15.0706 16.1672 15.0998 16.1818 15.13C16.2004 15.1685 16.2129 15.2087 16.2194 15.2493C16.2497 15.4405 16.15 15.6426 15.9533 15.7227C15.8642 15.759 15.7958 15.8192 15.75 15.8915C15.6613 16.0314 15.657 16.2166 15.75 16.3612C15.7742 16.3988 15.8049 16.4336 15.8424 16.4642L16.0405 16.6256C16.2807 16.8213 16.2869 17.1861 16.0535 17.3898L15.5008 17.8723C15.2722 18.0719 14.9199 18.0234 14.7536 17.7695L14.3316 17.1247C14.2784 17.0434 14.25 16.9482 14.25 16.8509V14.15C14.25 14.0816 14.2328 14.0172 14.2026 13.9609Z"
                      fill="currentColor"
                    ></path>
                  </svg>
                  Sign in with passkey
                </button>
                <div className="login-divider">
                  <span> or </span>
                </div>
                <div className="row-flex-container">
                  <div className="svg-holder">
                    <div className="svg-links-container">
                      <a>
                        <svg
                          width="800px"
                          height="800px"
                          viewBox="0 0 16 16"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                        >
                          <path
                            fill="#4285F4"
                            d="M14.9 8.161c0-.476-.039-.954-.121-1.422h-6.64v2.695h3.802a3.24 3.24 0 01-1.407 2.127v1.75h2.269c1.332-1.22 2.097-3.02 2.097-5.15z"
                          />
                          <path
                            fill="#34A853"
                            d="M8.14 15c1.898 0 3.499-.62 4.665-1.69l-2.268-1.749c-.631.427-1.446.669-2.395.669-1.836 0-3.393-1.232-3.952-2.888H1.85v1.803A7.044 7.044 0 008.14 15z"
                          />
                          <path
                            fill="#FBBC04"
                            d="M4.187 9.342a4.17 4.17 0 010-2.68V4.859H1.849a6.97 6.97 0 000 6.286l2.338-1.803z"
                          />
                          <path
                            fill="#EA4335"
                            d="M8.14 3.77a3.837 3.837 0 012.7 1.05l2.01-1.999a6.786 6.786 0 00-4.71-1.82 7.042 7.042 0 00-6.29 3.858L4.186 6.66c.556-1.658 2.116-2.89 3.952-2.89z"
                          />
                        </svg>
                      </a>
                    </div>

                    <div className="svg-links-container">
                      <a>
                        <svg
                          width="800px"
                          height="800px"
                          viewBox="0 0 16 16"
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                        >
                          <path
                            fill="#1877F2"
                            d="M15 8a7 7 0 00-7-7 7 7 0 00-1.094 13.915v-4.892H5.13V8h1.777V6.458c0-1.754 1.045-2.724 2.644-2.724.766 0 1.567.137 1.567.137v1.723h-.883c-.87 0-1.14.54-1.14 1.093V8h1.941l-.31 2.023H9.094v4.892A7.001 7.001 0 0015 8z"
                          />
                          <path
                            fill="#ffffff"
                            d="M10.725 10.023L11.035 8H9.094V6.687c0-.553.27-1.093 1.14-1.093h.883V3.87s-.801-.137-1.567-.137c-1.6 0-2.644.97-2.644 2.724V8H5.13v2.023h1.777v4.892a7.037 7.037 0 002.188 0v-4.892h1.63z"
                          />
                        </svg>
                      </a>
                    </div>
                    <div className="svg-links-container">
                      <a>
                        <svg
                          width="800px"
                          height="800px"
                          viewBox="0 0 15 15"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M7.87456 2.93707C7.66756 2.93707 7.49956 2.77259 7.49956 2.56993C7.49956 1.1506 8.67554 0 10.1245 0C10.3323 0 10.4995 0.164476 10.4995 0.367133C10.4995 1.78647 9.32429 2.93707 7.87456 2.93707Z"
                            fill="#000000"
                          />
                          <path
                            d="M7.87456 2.93707C7.66756 2.93707 7.49956 2.77259 7.49956 2.56993C7.49956 1.1506 8.67554 0 10.1245 0C10.3323 0 10.4995 0.164476 10.4995 0.367133C10.4995 1.78647 9.32429 2.93707 7.87456 2.93707Z"
                            fill="#000000"
                          />
                          <path
                            d="M13.3498 10.6678C13.4946 10.7743 13.5418 10.9674 13.4601 11.126C12.1401 13.7121 11.0871 15 10.1249 15C9.67713 15 9.23689 14.8583 8.8079 14.5822C8.18316 14.1791 7.37692 14.1622 6.73493 14.5381C6.21518 14.8429 5.72019 15 5.24995 15C3.83472 15 1.5 10.7332 1.5 8.3916C1.5 5.89216 2.83873 3.986 4.87495 3.986C5.83269 3.986 6.65993 4.12405 7.35442 4.40454C7.64916 4.52349 7.98216 4.51468 8.2694 4.37957C8.8334 4.1145 9.57664 3.986 10.4999 3.986C11.6264 3.986 12.6081 4.53524 13.4248 5.60139C13.5486 5.76366 13.5156 5.99349 13.3498 6.11538C12.4386 6.78429 11.9999 7.53618 11.9999 8.3916C11.9999 9.24702 12.4386 9.99891 13.3498 10.6678Z"
                            fill="#000000"
                          />
                          <path
                            d="M13.3498 10.6678C13.4946 10.7743 13.5418 10.9674 13.4601 11.126C12.1401 13.7121 11.0871 15 10.1249 15C9.67713 15 9.23689 14.8583 8.8079 14.5822C8.18316 14.1791 7.37692 14.1622 6.73493 14.5381C6.21518 14.8429 5.72019 15 5.24995 15C3.83472 15 1.5 10.7332 1.5 8.3916C1.5 5.89216 2.83873 3.986 4.87495 3.986C5.83269 3.986 6.65993 4.12405 7.35442 4.40454C7.64916 4.52349 7.98216 4.51468 8.2694 4.37957C8.8334 4.1145 9.57664 3.986 10.4999 3.986C11.6264 3.986 12.6081 4.53524 13.4248 5.60139C13.5486 5.76366 13.5156 5.99349 13.3498 6.11538C12.4386 6.78429 11.9999 7.53618 11.9999 8.3916C11.9999 9.24702 12.4386 9.99891 13.3498 10.6678Z"
                            fill="#000000"
                          />
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>

                <div className="help-link">
                  <p>
                    <span>New to Shopify? </span>
                    <a href="/signup"> Get Started</a>
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M3.49951 10C3.49951 9.58579 3.8353 9.25 4.24951 9.25L13.9391 9.25L11.2192 6.53036C10.9263 6.23748 10.9263 5.7626 11.2192 5.4697C11.512 5.17679 11.9869 5.17676 12.2798 5.46964L16.2802 9.46964C16.4209 9.6103 16.4999 9.80107 16.4999 10C16.4999 10.1989 16.4209 10.3897 16.2802 10.5304L12.2798 14.5304C11.9869 14.8232 11.512 14.8232 11.2192 14.5303C10.9263 14.2374 10.9263 13.7625 11.2192 13.4696L13.9391 10.75L4.24951 10.75C3.8353 10.75 3.49951 10.4142 3.49951 10Z"
                        fill="currentColor"
                      ></path>
                    </svg>
                  </p>
                </div>
              </>
            }
            <div className="footer">
              <div className="footer-links">
                <a>Help</a>
                <a>Privacy</a>
                <a>Terms</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    )
};

export default LoginPage;